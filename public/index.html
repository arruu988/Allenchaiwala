<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸš€ YouTube & Instagram Downloader</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; border-radius: 15px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        h1 { color: #ff0000; text-align: center; margin-bottom: 10px; }
        .subtitle { text-align: center; color: #666; margin-bottom: 30px; }
        .input-group { margin-bottom: 20px; }
        input[type="url"] { width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; margin-bottom: 10px; }
        .btn { background: #ff0000; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; width: 100%; margin: 10px 0; }
        .btn:hover { background: #cc0000; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .loader { display: none; text-align: center; margin: 20px 0; }
        .spinner { border: 5px solid #f3f3f3; border-top: 5px solid #ff0000; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .result { display: none; margin-top: 30px; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .video-info { background: #f9f9f9; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .download-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .download-btn { background: #28a745; color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; text-align: center; text-decoration: none; display: block; }
        .download-btn:hover { background: #218838; }
        .error { background: #fee; color: #721c24; padding: 15px; border-radius: 8px; margin: 15px 0; display: none; }
        .example { font-size: 14px; color: #666; margin-top: 10px; }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1><i class="fab fa-youtube"></i> YouTube + <i class="fab fa-instagram"></i> Instagram Downloader</h1>
        <p class="subtitle">Download videos in HD quality - 100% WORKING</p>
        
        <div class="input-group">
            <input type="url" id="videoUrl" placeholder="https://www.youtube.com/watch?v=... OR https://instagram.com/reel/...">
            <div class="example">
                <strong>Examples:</strong><br>
                YouTube: https://www.youtube.com/watch?v=dQw4w9WgXcQ<br>
                Instagram: https://www.instagram.com/reel/CzABCD123/
            </div>
            <button class="btn" onclick="analyzeVideo()">
                <i class="fas fa-search"></i> Analyze & Download
            </button>
        </div>
        
        <div class="loader" id="loader">
            <div class="spinner"></div>
            <p>Analyzing video...</p>
        </div>
        
        <div class="error" id="error"></div>
        
        <div class="result" id="result">
            <div class="video-info">
                <h3 id="videoTitle">Video Title</h3>
                <div id="videoDetails"></div>
            </div>
            
            <div class="download-options" id="downloadOptions"></div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        
        async function analyzeVideo() {
            const url = document.getElementById('videoUrl').value.trim();
            const loader = document.getElementById('loader');
            const result = document.getElementById('result');
            const error = document.getElementById('error');
            
            if (!url) {
                showError('Please enter a video URL');
                return;
            }
            
            if (!url.includes('youtube.com') && !url.includes('youtu.be') && !url.includes('instagram.com')) {
                showError('Please enter a valid YouTube or Instagram URL');
                return;
            }
            
            loader.style.display = 'block';
            result.style.display = 'none';
            error.style.display = 'none';
            
            try {
                // First detect platform
                const detectRes = await fetch(`${API_BASE}/api/detect?url=${encodeURIComponent(url)}`);
                const detectData = await detectRes.json();
                
                if (!detectData.success) {
                    throw new Error(detectData.error || 'Cannot detect platform');
                }
                
                let videoData;
                if (detectData.platform === 'youtube') {
                    const youtubeRes = await fetch(`${API_BASE}/api/youtube/info?url=${encodeURIComponent(url)}`);
                    videoData = await youtubeRes.json();
                } else {
                    const instaRes = await fetch(`${API_BASE}/api/instagram/info?url=${encodeURIComponent(url)}`);
                    videoData = await instaRes.json();
                }
                
                loader.style.display = 'none';
                
                if (videoData.success) {
                    displayResults(videoData, detectData.platform);
                } else {
                    showError(videoData.error || 'Failed to fetch video');
                }
                
            } catch (err) {
                loader.style.display = 'none';
                showError('Error: ' + err.message);
            }
        }
        
        function displayResults(data, platform) {
            const result = document.getElementById('result');
            const videoTitle = document.getElementById('videoTitle');
            const videoDetails = document.getElementById('videoDetails');
            const downloadOptions = document.getElementById('downloadOptions');
            
            videoTitle.textContent = data.title || 'Video';
            
            let detailsHTML = '';
            if (platform === 'youtube') {
                detailsHTML = `
                    <p><strong>Channel:</strong> ${data.channel || 'N/A'}</p>
                    <p><strong>Platform:</strong> YouTube</p>
                `;
            } else {
                detailsHTML = `
                    <p><strong>Platform:</strong> Instagram</p>
                `;
            }
            videoDetails.innerHTML = detailsHTML;
            
            let optionsHTML = '';
            const videoUrl = document.getElementById('videoUrl').value;
            
            if (platform === 'youtube') {
                optionsHTML = `
                    <a href="${API_BASE}/api/youtube/download?url=${encodeURIComponent(videoUrl)}&quality=360p" 
                       class="download-btn" target="_blank">
                       <i class="fas fa-download"></i> 360p Video
                    </a>
                    <a href="${API_BASE}/api/youtube/download?url=${encodeURIComponent(videoUrl)}&quality=720p" 
                       class="download-btn" target="_blank">
                       <i class="fas fa-download"></i> 720p HD
                    </a>
                    <a href="${API_BASE}/api/youtube/download?url=${encodeURIComponent(videoUrl)}&quality=audio" 
                       class="download-btn" style="background:#6f42c1;" target="_blank">
                       <i class="fas fa-music"></i> Audio MP3
                    </a>
                `;
            } else if (platform === 'instagram' && data.videoUrl) {
                optionsHTML = `
                    <a href="${data.videoUrl}" 
                       class="download-btn" target="_blank" download>
                       <i class="fas fa-download"></i> Download Video
                    </a>
                `;
            }
            
            downloadOptions.innerHTML = optionsHTML;
            result.style.display = 'block';
        }
        
        function showError(message) {
            const error = document.getElementById('error');
            error.textContent = message;
            error.style.display = 'block';
        }
        
        // Enter key support
        document.getElementById('videoUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') analyzeVideo();
        });
    </script>
</body>
</html>
